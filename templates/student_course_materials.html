{% extends "base.html" %}

{% block title %}Materials - {{ course.course_name }}{% endblock %}

{% block content %}
<div class="student-materials-page">

    <!-- Header Banner -->
    <div class="materials-banner-header">
        <div class="banner-header-left">
            <a href="{{ url_for('student_home') }}" class="banner-back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </a>
            <div class="banner-header-info">
                <h1>Course Materials</h1>
                <h2>{{ course.course_name }}</h2>
                <h3>{{ course.course_code }} - {{ course.block_section }}</h3>
            </div>
        </div>

        <div class="banner-header-stats">
            <span class="banner-stat-number">{{ total_materials }}</span>
            <span class="banner-stat-label">Total Materials</span>
        </div>
    </div>

    <!-- Materials by Lesson -->
    {% if lesson_plans %}
    <div class="materials-grid-layout">
        {% for plan in lesson_plans %}
        {% if plan.materials %}
        <div class="materials-lesson-card">
            <div class="materials-card-header">
                <h3>{{ plan.title }}</h3>
                <span class="materials-file-count">{{ plan.materials|length }} file(s)</span>
            </div>

            <div class="materials-files-list">
                {% for material in plan.materials %}
                <div class="materials-file-item">
                    <div class="materials-file-left">
                        <!-- File Icon Badge -->
                        {% set file_lower = material.filename.lower() %}
                        {% if file_lower.endswith('.pdf') %}
                        <span class="materials-file-badge badge-pdf">PDF</span>
                        {% elif file_lower.endswith(('.doc', '.docx')) %}
                        <span class="materials-file-badge badge-doc">DOC</span>
                        {% elif file_lower.endswith(('.ppt', '.pptx', '.pptm')) %}
                        <span class="materials-file-badge badge-ppt">PPT</span>
                        {% elif file_lower.endswith(('.jpg', '.jpeg', '.png', '.gif', '.svg', '.webp')) %}
                        <span class="materials-file-badge badge-img">IMG</span>
                        {% elif file_lower.endswith(('.mp4', '.avi', '.mov', '.wmv', '.mkv')) %}
                        <span class="materials-file-badge badge-vid">VID</span>
                        {% elif file_lower.endswith(('.zip', '.rar', '.7z')) %}
                        <span class="materials-file-badge badge-zip">ZIP</span>
                        {% elif file_lower.endswith(('.xls', '.xlsx')) %}
                        <span class="materials-file-badge badge-xls">XLS</span>
                        {% else %}
                        <span class="materials-file-badge badge-file">FILE</span>
                        {% endif %}

                        <div class="materials-file-details">
                            <p class="materials-file-name">{{ material.filename }}</p>
                            <p class="materials-file-date">
                                Uploaded {{ material.uploaded_at.strftime('%B %d, %Y') }}
                            </p>
                        </div>
                    </div>

                    <a href="{{ url_for('student_download_material', material_id=material.id) }}"
                       class="materials-download-btn"
                       title="Download file"
                       aria-label="Download file">

                        <!-- Download SVG Icon -->
                        <svg class="download-icon"
                             width="18"
                             height="18"
                             viewBox="0 0 24 24"
                             fill="none"
                             stroke="currentColor"
                             stroke-width="2"
                             stroke-linecap="round"
                             stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                    </a>

                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="materials-empty-state">
        <div class="materials-empty-icon">ðŸ“š</div>
        <h3>No Materials Yet</h3>
        <p>Your educator hasn't uploaded any materials for this course.</p>
    </div>
    {% endif %}
</div>
{% endblock %}