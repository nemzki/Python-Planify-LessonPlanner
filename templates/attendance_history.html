{% extends "educator_base.html" %}

{% block content %}
<div class="attendance-history-container">
    <div class="history-header">
        <div class="header-left">
            <a href="{{ url_for('educator_courses') }}" class="back-icon-btn">
                <img src="{{ url_for('static', filename='pictures/back-button.png') }}" alt="Back">
            </a>
            <h2>Attendance History - {{ course.course_name }}</h2>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('course_attendance', course_id=course.id) }}" class="record-new-btn">
                âž• Record New Attendance
            </a>
        </div>
    </div>

    <div class="history-info">
        <p>View all attendance records for this course, organized by date.</p>
    </div>

    {% if attendance_by_date %}
        <div class="attendance-timeline">
            {% for date, data in attendance_by_date.items() %}
            <div class="date-card">
                <div class="date-card-header">
                    <div class="date-info">
                        <h3>{{ date.strftime('%A, %B %d, %Y') }}</h3>
                        <p class="recorded-time">
                            ðŸ“… Recorded on: {{ data.recorded_time.strftime('%B %d, %Y at %I:%M %p') }}
                        </p>
                    </div>
                    <a href="{{ url_for('view_attendance_date', course_id=course.id, date_str=date.strftime('%Y-%m-%d')) }}"
                       class="view-details-btn">
                        View Details
                    </a>
                </div>

                <div class="date-card-stats">
                    <div class="stat-box total">
                        <span class="stat-label">Total Students</span>
                        <span class="stat-value">{{ data.stats.total }}</span>
                    </div>
                    <div class="stat-box present">
                        <span class="stat-label">Present</span>
                        <span class="stat-value">{{ data.stats.present }}</span>
                    </div>
                    <div class="stat-box absent">
                        <span class="stat-label">Absent</span>
                        <span class="stat-value">{{ data.stats.absent }}</span>
                    </div>
                    <div class="stat-box excused">
                        <span class="stat-label">Excused</span>
                        <span class="stat-value">{{ data.stats.excused }}</span>
                    </div>
                    <div class="stat-box late">
                        <span class="stat-label">Late</span>
                        <span class="stat-value">{{ data.stats.late }}</span>
                    </div>
                </div>

                <div class="attendance-summary">
                    <div class="summary-bar">
                        {% set total = data.stats.total %}
                        {% if total > 0 %}
                            <div class="bar-segment present"
                                 style="width: {{ (data.stats.present / total * 100) }}%"
                                 title="Present: {{ data.stats.present }}"></div>
                            <div class="bar-segment late"
                                 style="width: {{ (data.stats.late / total * 100) }}%"
                                 title="Late: {{ data.stats.late }}"></div>
                            <div class="bar-segment excused"
                                 style="width: {{ (data.stats.excused / total * 100) }}%"
                                 title="Excused: {{ data.stats.excused }}"></div>
                            <div class="bar-segment absent"
                                 style="width: {{ (data.stats.absent / total * 100) }}%"
                                 title="Absent: {{ data.stats.absent }}"></div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <p>ðŸ“‹ No attendance records yet for this course.</p>
            <a href="{{ url_for('course_attendance', course_id=course.id) }}" class="start-recording-btn">
                Start Recording Attendance
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}